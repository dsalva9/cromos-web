-- Generated by Gemini
-- This script will create the "Panini La Liga 2025 26" collection and all its related data.

DO $$
DECLARE
    new_collection_id BIGINT;
    team_record RECORD;
    page_record RECORD;
    sticker_record RECORD;
    team_map JSONB := '{}'::JSONB;
    page_map JSONB := '{}'::JSONB;
BEGIN

-- 1. Create the main collection
INSERT INTO collections (name, competition, year, description)
VALUES ('Panini La Liga 2025 26', 'La Liga', '2025-26', 'Colección oficial de La Liga 2025-26')
RETURNING id INTO new_collection_id;

-- 2. Create all unique teams
WITH unique_teams (name) AS (
    VALUES
        ('DEPORTIVO ALAVÉS'), ('ATHLETIC CLUB'), ('ATLÉTICO DE MADRID'), ('FC BARCELONA'),
        ('REAL BETIS'), ('RC CELTA'), ('ELCHE CF'), ('RCD ESPANYOL'), ('GETAFE CF'),
        ('GIRONA FC'), ('LEVANTE UD'), ('REAL MADRID'), ('RCD MALLORCA'), ('C.A. OSASUNA'),
        ('REAL OVIEDO'), ('RAYO VALLECANO'), ('REAL SOCIEDAD'), ('SEVILLA FC'),
        ('VALENCIA CF'), ('VILLARREAL CF')
)
INSERT INTO collection_teams (collection_id, team_name)
SELECT new_collection_id, name FROM unique_teams;

-- Build a map of team names to IDs for easy lookup
FOR team_record IN SELECT id, team_name FROM collection_teams WHERE collection_id = new_collection_id LOOP
    team_map := jsonb_set(team_map, ARRAY[team_record.team_name], to_jsonb(team_record.id));
END LOOP;

-- 3. Create collection pages (teams and specials)
WITH pages_to_create (kind, team_name, title, order_index) AS (
    VALUES
        ('team', 'DEPORTIVO ALAVÉS', 'Deportivo Alavés', 1),
        ('team', 'ATHLETIC CLUB', 'Athletic Club', 2),
        ('team', 'ATLÉTICO DE MADRID', 'Atlético de Madrid', 3),
        ('team', 'FC BARCELONA', 'FC Barcelona', 4),
        ('team', 'REAL BETIS', 'Real Betis', 5),
        ('team', 'RC CELTA', 'RC Celta', 6),
        ('team', 'ELCHE CF', 'Elche CF', 7),
        ('team', 'RCD ESPANYOL', 'RCD Espanyol', 8),
        ('team', 'GETAFE CF', 'Getafe CF', 9),
        ('team', 'GIRONA FC', 'Girona FC', 10),
        ('team', 'LEVANTE UD', 'Levante UD', 11),
        ('team', 'REAL MADRID', 'Real Madrid', 12),
        ('team', 'RCD MALLORCA', 'RCD Mallorca', 13),
        ('team', 'C.A. OSASUNA', 'CA Osasuna', 14),
        ('team', 'REAL OVIEDO', 'Real Oviedo', 15),
        ('team', 'RAYO VALLECANO', 'Rayo Vallecano', 16),
        ('team', 'REAL SOCIEDAD', 'Real Sociedad', 17),
        ('team', 'SEVILLA FC', 'Sevilla FC', 18),
        ('team', 'VALENCIA CF', 'Valencia CF', 19),
        ('team', 'VILLARREAL CF', 'Villarreal CF', 20),
        ('special', NULL, 'ADN LaLiga / Super Kids', 21),
        ('special', NULL, 'Mister Cero', 22),
        ('special', NULL, 'Icono Mister Cero', 23),
        ('special', NULL, 'Mix', 24),
        ('special', NULL, 'Últimos Fichajes', 25),
        ('special', NULL, 'Extra Gold', 26),
        ('special', NULL, 'Supreme Extra Gold', 27)
)
INSERT INTO collection_pages (collection_id, kind, team_id, title, order_index)
SELECT new_collection_id, kind, (team_map->>team_name)::BIGINT, title, order_index
FROM pages_to_create;

-- Build a map of page titles to IDs for easy lookup
FOR page_record IN SELECT id, title FROM collection_pages WHERE collection_id = new_collection_id LOOP
    page_map := jsonb_set(page_map, ARRAY[page_record.title], to_jsonb(page_record.id));
END LOOP;

-- 4. Create all stickers and their slots
WITH stickers_data (raw_id, name, code, team_name, special_page_name) AS (
    VALUES
        (1,'Escudo Deportivo Alavés','1','DEPORTIVO ALAVÉS',NULL),
        (2,'Entrenador Deportivo Alavés - Eduardo Coudet','2','DEPORTIVO ALAVÉS',NULL),
        (3,'Sivera','3','DEPORTIVO ALAVÉS',NULL),
        (4,'Owono','4','DEPORTIVO ALAVÉS',NULL),
        (5,'Tenaglia','5','DEPORTIVO ALAVÉS',NULL),
        (6,'Hugo Novoa','6','DEPORTIVO ALAVÉS',NULL),
        (7,'Garcés','7','DEPORTIVO ALAVÉS',NULL),
        (8,'Mouriño','8','DEPORTIVO ALAVÉS',NULL),
        (9,'Moussa Diarra','9','DEPORTIVO ALAVÉS',NULL),
        (10,'Manu Sánchez','10','DEPORTIVO ALAVÉS',NULL),
        (11,'Guevara','11','DEPORTIVO ALAVÉS',NULL),
        (12,'Benavídez','12','DEPORTIVO ALAVÉS',NULL),
        (13,'Guridi','13','DEPORTIVO ALAVÉS',NULL),
        (14,'Blanco','14','DEPORTIVO ALAVÉS',NULL),
        (15,'Aleñá','15','DEPORTIVO ALAVÉS',NULL),
        (16,'Calebe','16','DEPORTIVO ALAVÉS',NULL),
        (17,'Carlos Vicente','17','DEPORTIVO ALAVÉS',NULL),
        (18,'Toni Martínez','18','DEPORTIVO ALAVÉS',NULL),
        (19,'Conechny','19','DEPORTIVO ALAVÉS',NULL),
        (20,'Villalibre','20','DEPORTIVO ALAVÉS',NULL),
        (21,'Raúl Fernández','04BIS','DEPORTIVO ALAVÉS',NULL),
        (22,'Jonny','10BIS','DEPORTIVO ALAVÉS',NULL),
        (23,'Yusi','6BIS','DEPORTIVO ALAVÉS',NULL),
        (24,'Parada','8BIS','DEPORTIVO ALAVÉS',NULL),
        (25,'Mariano','20BIS','DEPORTIVO ALAVÉS',NULL),
        (41,'Escudo Athletic Club','1','ATHLETIC CLUB',NULL),
        (42,'Entrenador Athletic Club - Ernesto Valverde','2','ATHLETIC CLUB',NULL),
        (43,'Unai Simón','3','ATHLETIC CLUB',NULL),
        (44,'Padilla','4','ATHLETIC CLUB',NULL),
        (45,'Gorosabel','5A','ATHLETIC CLUB',NULL),
        (46,'Lekue','5B','ATHLETIC CLUB',NULL),
        (47,'Vivian','6','ATHLETIC CLUB',NULL),
        (48,'Paredes','7','ATHLETIC CLUB',NULL),
        (49,'Yeray','8','ATHLETIC CLUB',NULL),
        (50,'Yuri','9A','ATHLETIC CLUB',NULL),
        (51,'Adama Boiro','9B','ATHLETIC CLUB',NULL),
        (52,'Vesga','10','ATHLETIC CLUB',NULL),
        (53,'Jauregizar','11','ATHLETIC CLUB',NULL),
        (54,'Prados','12','ATHLETIC CLUB',NULL),
        (55,'Ruiz de Galarreta','13','ATHLETIC CLUB',NULL),
        (56,'Unai Gómez','14','ATHLETIC CLUB',NULL),
        (57,'Sancet','15','ATHLETIC CLUB',NULL),
        (58,'Nico Williams','16','ATHLETIC CLUB',NULL),
        (59,'Maroan','17A','ATHLETIC CLUB',NULL),
        (60,'Djaló','17B','ATHLETIC CLUB',NULL),
        (61,'Williams','18','ATHLETIC CLUB',NULL),
        (62,'Guruzeta','19','ATHLETIC CLUB',NULL),
        (63,'Berenguer','20','ATHLETIC CLUB',NULL),
        (71,'Escudo Atlético de Madrid','1','ATLÉTICO DE MADRID',NULL),
        (72,'Entrenador Atlético de Madrid - Diego Pablo Simeone','2','ATLÉTICO DE MADRID',NULL),
        (73,'Oblak','3','ATLÉTICO DE MADRID',NULL),
        (74,'Musso','4','ATLÉTICO DE MADRID',NULL),
        (75,'Nahuel Molina','5','ATLÉTICO DE MADRID',NULL),
        (76,'Giménez','6','ATLÉTICO DE MADRID',NULL),
        (77,'Le Normand','7','ATLÉTICO DE MADRID',NULL),
        (78,'Lenglet','8','ATLÉTICO DE MADRID',NULL),
        (79,'Galán','9','ATLÉTICO DE MADRID',NULL),
        (80,'Gallagher','10','ATLÉTICO DE MADRID',NULL),
        (81,'Marcos Llorente','11','ATLÉTICO DE MADRID',NULL),
        (82,'De Paul','12','ATLÉTICO DE MADRID',NULL),
        (83,'Barrios','13','ATLÉTICO DE MADRID',NULL),
        (84,'Koke','14','ATLÉTICO DE MADRID',NULL),
        (85,'Samuel Lino','15','ATLÉTICO DE MADRID',NULL),
        (86,'Johnny Cardoso','16','ATLÉTICO DE MADRID',NULL),
        (87,'Giuliano','17','ATLÉTICO DE MADRID',NULL),
        (88,'Griezmann','18','ATLÉTICO DE MADRID',NULL),
        (89,'Julián Álvarez','19','ATLÉTICO DE MADRID',NULL),
        (90,'Sorloth','20','ATLÉTICO DE MADRID',NULL),
        (91,'Pubill','5BIS','ATLÉTICO DE MADRID',NULL),
        (92,'Ruggeri','9BIS','ATLÉTICO DE MADRID',NULL),
        (93,'Almada','15BIS','ATLÉTICO DE MADRID',NULL),
        (101,'Escudo FC Barcelona','1','FC BARCELONA',NULL),
        (102,'Entrenador FC Barcelona - Hansi Flick','2','FC BARCELONA',NULL),
        (103,'Ter Stegen','3','FC BARCELONA',NULL),
        (104,'Szczesny','4','FC BARCELONA',NULL),
        (105,'Koundé','5','FC BARCELONA',NULL),
        (106,'Cubarsí','6','FC BARCELONA',NULL),
        (107,'Íñigo Martínez','7','FC BARCELONA',NULL),
        (108,'Araújo','8A','FC BARCELONA',NULL),
        (109,'Christensen','8B','FC BARCELONA',NULL),
        (110,'Eric García','9A','FC BARCELONA',NULL),
        (111,'Héctor Fort','9B','FC BARCELONA',NULL),
        (112,'Balde','10A','FC BARCELONA',NULL),
        (113,'Gerard Martín','10B','FC BARCELONA',NULL),
        (114,'Casado','11A','FC BARCELONA',NULL),
        (115,'Marc Bernal','11B','FC BARCELONA',NULL),
        (116,'De Jong','12','FC BARCELONA',NULL),
        (117,'Fermín','13','FC BARCELONA',NULL),
        (118,'Gavi','14','FC BARCELONA',NULL),
        (119,'Pedri','15','FC BARCELONA',NULL),
        (120,'Dani Olmo','16','FC BARCELONA',NULL),
        (121,'Ferran Torres','17','FC BARCELONA',NULL),
        (122,'Raphinha','18','FC BARCELONA',NULL),
        (123,'Lamine Yamal','19','FC BARCELONA',NULL),
        (124,'Lewandowski','20','FC BARCELONA',NULL),
        (125,'Jofre Torrents','7BIS','FC BARCELONA',NULL),
        (131,'Escudo Real Betis','1','REAL BETIS',NULL),
        (132,'Entrenador Real Betis - Manuel Pellegrini','2','REAL BETIS',NULL),
        (133,'Pau López','3','REAL BETIS',NULL),
        (134,'Adrián','4','REAL BETIS',NULL),
        (135,'Aitor Ruibal','5A','REAL BETIS',NULL),
        (136,'Ortiz','5B','REAL BETIS',NULL),
        (137,'Bartra','6','REAL BETIS',NULL),
        (138,'Natan','7','REAL BETIS',NULL),
        (139,'Diego Llorente','8','REAL BETIS',NULL),
        (140,'Perraud','9','REAL BETIS',NULL),
        (141,'Ricardo Rodríguez','10A','REAL BETIS',NULL),
        (142,'Junior','10B','REAL BETIS',NULL),
        (143,'Marc Roca','11','REAL BETIS',NULL),
        (144,'Altimira','12','REAL BETIS',NULL),
        (145,'Lo Celso','13','REAL BETIS',NULL),
        (146,'Pablo Fornals','14','REAL BETIS',NULL),
        (147,'Isco','15','REAL BETIS',NULL),
        (148,'Pablo García','16','REAL BETIS',NULL),
        (149,'Antony','17','REAL BETIS',NULL),
        (150,'Abde','18','REAL BETIS',NULL),
        (151,'Bakambu','19','REAL BETIS',NULL),
        (152,'Cucho Hernández','20','REAL BETIS',NULL),
        (153,'Bellerín','9BIS','REAL BETIS',NULL),
        (161,'Escudo RC Celta','1','RC CELTA',NULL),
        (162,'Entrenador RC Celta - Claudio Giráldez','2','RC CELTA',NULL),
        (163,'Radu','3','RC CELTA',NULL),
        (164,'Iván Villar','4','RC CELTA',NULL),
        (165,'Javi Rodriguez','5','RC CELTA',NULL),
        (166,'Carreira','6','RC CELTA',NULL),
        (167,'Domínguez','7A','RC CELTA',NULL),
        (168,'Yoel Lago','7B','RC CELTA',NULL),
        (169,'Starfelt','8','RC CELTA',NULL),
        (170,'Mingueza','9','RC CELTA',NULL),
        (171,'Marcos Alonso','10A','RC CELTA',NULL),
        (172,'Ristic','10B','RC CELTA',NULL),
        (173,'Fran Beltrán','11','RC CELTA',NULL),
        (174,'Ilaix Moriba','12','RC CELTA',NULL),
        (175,'Damián','13','RC CELTA',NULL),
        (176,'Hugo Álvarez','14','RC CELTA',NULL),
        (177,'Sotelo','15','RC CELTA',NULL),
        (178,'Cervi','16','RC CELTA',NULL),
        (179,'Pablo Durán','17','RC CELTA',NULL),
        (180,'Swedberg','18','RC CELTA',NULL),
        (181,'Borja Iglesias','19','RC CELTA',NULL),
        (182,'Iago Aspas','20','RC CELTA',NULL),
        (191,'Escudo Elche CF','1','ELCHE CF',NULL),
        (192,'Entrenador Elche CF - Eder Sarabia','2','ELCHE CF',NULL),
        (193,'Dituro','3','ELCHE CF',NULL),
        (194,'Iturbe','4','ELCHE CF',NULL),
        (195,'Álvaro Núñez','5','ELCHE CF',NULL),
        (196,'Diaby','6','ELCHE CF',NULL),
        (197,'Affengruber','7','ELCHE CF',NULL),
        (198,'John Chetauya','8','ELCHE CF',NULL),
        (199,'Bigas','9','ELCHE CF',NULL),
        (200,'Jairo','10','ELCHE CF',NULL),
        (201,'Febas','11','ELCHE CF',NULL),
        (202,'Marc Aguado','12','ELCHE CF',NULL),
        (203,'Martim Neto','13','ELCHE CF',NULL),
        (204,'Nico Fernández','14','ELCHE CF',NULL),
        (205,'Josan','15A','ELCHE CF',NULL),
        (206,'Rodri Mendoza','15B','ELCHE CF',NULL),
        (207,'Yago Santiago','16','ELCHE CF',NULL),
        (208,'Agustín Álvarez','17','ELCHE CF',NULL),
        (209,'Germán Valera','18','ELCHE CF',NULL),
        (210,'Óscar Plano','19','ELCHE CF',NULL),
        (211,'Mourad','20','ELCHE CF',NULL),
        (212,'Pétrot','10BIS','ELCHE CF',NULL),
        (213,'Fede Redondo','14BIS','ELCHE CF',NULL),
        (214,'Ali Houary','16BIS','ELCHE CF',NULL),
        (215,'Rafa Mir','17BIS','ELCHE CF',NULL),
        (216,'Álvaro Rodríguez','19BIS','ELCHE CF',NULL),
        (221,'Escudo RCD Espanyol','1','RCD ESPANYOL',NULL),
        (222,'Entrenador RCD Espanyol - Manolo González','2','RCD ESPANYOL',NULL),
        (223,'Dmitrovic','3','RCD ESPANYOL',NULL),
        (224,'Fortuño','4','RCD ESPANYOL',NULL),
        (225,'El Hilali','5','RCD ESPANYOL',NULL),
        (226,'Cabrera','6','RCD ESPANYOL',NULL),
        (227,'Calero','7','RCD ESPANYOL',NULL),
        (228,'Pablo Ramón','8','RCD ESPANYOL',NULL),
        (229,'Carlos Romero','9','RCD ESPANYOL',NULL),
        (230,'Salinas','10','RCD ESPANYOL',NULL),
        (231,'Rubén Sánchez','11','RCD ESPANYOL',NULL),
        (232,'Gragera','12','RCD ESPANYOL',NULL),
        (233,'Terrats','13','RCD ESPANYOL',NULL),
        (234,'Edu Expósito','14','RCD ESPANYOL',NULL),
        (235,'Pol Lozano','15','RCD ESPANYOL',NULL),
        (236,'Antoniu Roca','16','RCD ESPANYOL',NULL),
        (237,'Jofre','17','RCD ESPANYOL',NULL),
        (238,'Roberto Fernández','18','RCD ESPANYOL',NULL),
        (239,'Puado','19','RCD ESPANYOL',NULL),
        (240,'Pere Milla','20','RCD ESPANYOL',NULL),
        (251,'Escudo Getafe CF','1','GETAFE CF',NULL),
        (252,'Entrenador Getafe CF - José Bordalás','2','GETAFE CF',NULL),
        (253,'David Soria','3','GETAFE CF',NULL),
        (254,'Letacek','4','GETAFE CF',NULL),
        (255,'Iglesias','5','GETAFE CF',NULL),
        (256,'Sola','6A','GETAFE CF',NULL),
        (257,'Davinchi','6B','GETAFE CF',NULL),
        (258,'Alderete','7','GETAFE CF',NULL),
        (259,'Djene','8','GETAFE CF',NULL),
        (260,'Domingos Duarte','9A','GETAFE CF',NULL),
        (261,'Berrocal','9B','GETAFE CF',NULL),
        (262,'Diego Rico','10','GETAFE CF',NULL),
        (263,'Arambarri','11','GETAFE CF',NULL),
        (264,'Mario Martín','12','GETAFE CF',NULL),
        (265,'Uche','13','GETAFE CF',NULL),
        (266,'Milla','14','GETAFE CF',NULL),
        (267,'Javi Muñoz','15','GETAFE CF',NULL),
        (268,'Coba','16','GETAFE CF',NULL),
        (269,'Peter Federico','17','GETAFE CF',NULL),
        (270,'Juanmi','18','GETAFE CF',NULL),
        (271,'Borja Mayoral','19','GETAFE CF',NULL),
        (272,'Álvaro Rodríguez','20','GETAFE CF',NULL),
        (273,'Álex Sancris','20BIS','GETAFE CF',NULL),
        (281,'Escudo Girona FC','1','GIRONA FC',NULL),
        (282,'Entrenador Girona FC - Míchel','2','GIRONA FC',NULL),
        (283,'Gazzaniga','3','GIRONA FC',NULL),
        (284,'Krapivtsov','4A','GIRONA FC',NULL),
        (285,'Juan Carlos','4B','GIRONA FC',NULL),
        (286,'Arnau','5','GIRONA FC',NULL),
        (287,'Francés','6','GIRONA FC',NULL),
        (288,'David López','7','GIRONA FC',NULL),
        (289,'Krejci','8','GIRONA FC',NULL),
        (290,'Blind','9','GIRONA FC',NULL),
        (291,'Miguel Gutiérrez','10','GIRONA FC',NULL),
        (292,'Solis','11','GIRONA FC',NULL),
        (293,'Van de Beek','12','GIRONA FC',NULL),
        (294,'Arthur','13','GIRONA FC',NULL),
        (295,'Yangel Herrera','14','GIRONA FC',NULL),
        (296,'Ivan Martín','15','GIRONA FC',NULL),
        (297,'Tsygankov','16','GIRONA FC',NULL),
        (298,'Yáser Asprilla','17','GIRONA FC',NULL),
        (299,'Portu','18A','GIRONA FC',NULL),
        (300,'Misehouy','18B','GIRONA FC',NULL),
        (301,'Stuani','19','GIRONA FC',NULL),
        (302,'Abel Ruiz','20A','GIRONA FC',NULL),
        (303,'Miovski','20B','GIRONA FC',NULL),
        (304,'Joel Roca','13BIS','GIRONA FC',NULL),
        (311,'Escudo Levante UD','1','LEVANTE UD',NULL),
        (312,'Entrenador Levante UD - Julián Calero','2','LEVANTE UD',NULL),
        (313,'Pablo Campos','3','LEVANTE UD',NULL),
        (314,'Alfonso Pastor','4','LEVANTE UD',NULL),
        (315,'Xavi Grande','5','LEVANTE UD',NULL),
        (316,'Dela','6','LEVANTE UD',NULL),
        (317,'Cabello','7','LEVANTE UD',NULL),
        (318,'Matturro','8','LEVANTE UD',NULL),
        (319,'Elgezabal','9','LEVANTE UD',NULL),
        (320,'Pampín','10','LEVANTE UD',NULL),
        (321,'Iborra','11','LEVANTE UD',NULL),
        (322,'Oriol Rey','12','LEVANTE UD',NULL),
        (323,'Sergio Lozano','13','LEVANTE UD',NULL),
        (324,'Olasagasti','14','LEVANTE UD',NULL),
        (325,'Pablo Martínez','15','LEVANTE UD',NULL),
        (326,'Carlos Álvarez','16','LEVANTE UD',NULL),
        (327,'Iván Romero','17','LEVANTE UD',NULL),
        (328,'Morales','18','LEVANTE UD',NULL),
        (329,'Carlos Espí','19A','LEVANTE UD',NULL),
        (330,'Víctor Fernández','19B','LEVANTE UD',NULL),
        (331,'Brugué','20','LEVANTE UD',NULL),
        (332,'Víctor García','05BIS','LEVANTE UD',NULL),
        (333,'Manu Sánchez','11BIS','LEVANTE UD',NULL),
        (334,'Iker Losada','13BIS','LEVANTE UD',NULL),
        (341,'Escudo Real Madrid','1','REAL MADRID',NULL),
        (342,'Entrenador Real Madrid - Xabi Alonso','2','REAL MADRID',NULL),
        (343,'Courtois','3','REAL MADRID',NULL),
        (344,'Lunin','4','REAL MADRID',NULL),
        (345,'Carvajal','5','REAL MADRID',NULL),
        (346,'Asencio','6','REAL MADRID',NULL),
        (347,'Rüdiger','7','REAL MADRID',NULL),
        (348,'Militao','8','REAL MADRID',NULL),
        (349,'Alaba','9','REAL MADRID',NULL),
        (350,'Mendy','10A','REAL MADRID',NULL),
        (351,'Fran García','10B','REAL MADRID',NULL),
        (352,'Tchouaméni','11','REAL MADRID',NULL),
        (353,'Camavinga','12','REAL MADRID',NULL),
        (354,'Dani Ceballos','13','REAL MADRID',NULL),
        (355,'Fede Valverde','14','REAL MADRID',NULL),
        (356,'Bellingham','15','REAL MADRID',NULL),
        (357,'Güler','16','REAL MADRID',NULL),
        (358,'Brahim Díaz','17A','REAL MADRID',NULL),
        (359,'Endrick','17B','REAL MADRID',NULL),
        (360,'Rodrygo','18','REAL MADRID',NULL),
        (361,'Mbappé','19','REAL MADRID',NULL),
        (362,'Vinícius','20','REAL MADRID',NULL),
        (363,'Gonzalo','18BIS','REAL MADRID',NULL),
        (371,'Escudo RCD Mallorca','1','RCD MALLORCA',NULL),
        (372,'Entrenador RCD Mallorca - Jagoba Arrasate','2','RCD MALLORCA',NULL),
        (373,'Greif','3','RCD MALLORCA',NULL),
        (374,'Bergström','4','RCD MALLORCA',NULL),
        (375,'Maffeo','5A','RCD MALLORCA',NULL),
        (376,'Morey','5B','RCD MALLORCA',NULL),
        (377,'Raillo','6','RCD MALLORCA',NULL),
        (378,'Copete','7','RCD MALLORCA',NULL),
        (379,'Valjent','8','RCD MALLORCA',NULL),
        (380,'Mojica','9','RCD MALLORCA',NULL),
        (381,'Lato','10','RCD MALLORCA',NULL),
        (382,'Mascarell','11','RCD MALLORCA',NULL),
        (383,'Samu Costa','12','RCD MALLORCA',NULL),
        (384,'Darder','13','RCD MALLORCA',NULL),
        (385,'Antonio Sánchez','14','RCD MALLORCA',NULL),
        (386,'Dani Rodríguez','15','RCD MALLORCA',NULL),
        (387,'Morlanes','16','RCD MALLORCA',NULL),
        (388,'Marc Domènech','17','RCD MALLORCA',NULL),
        (389,'Asano','18','RCD MALLORCA',NULL),
        (390,'Muriqi','19','RCD MALLORCA',NULL),
        (391,'Abdón','20A','RCD MALLORCA',NULL),
        (392,'Larin','20B','RCD MALLORCA',NULL),
        (393,'Leo Román','03BIS','RCD MALLORCA',NULL),
        (394,'Kumbulla','7BIS','RCD MALLORCA',NULL),
        (401,'Escudo CA Osasuna','1','C.A. OSASUNA',NULL),
        (402,'Entrenador CA Osasuna - Alessio Lisci','2','C.A. OSASUNA',NULL),
        (403,'Sergio Herrera','3','C.A. OSASUNA',NULL),
        (404,'Aitor Fernández','4','C.A. OSASUNA',NULL),
        (405,'Rosier','5','C.A. OSASUNA',NULL),
        (406,'Catena','6','C.A. OSASUNA',NULL),
        (407,'Boyomo','7','C.A. OSASUNA',NULL),
        (408,'Herrando','8','C.A. OSASUNA',NULL),
        (409,'Juan Cruz','9','C.A. OSASUNA',NULL),
        (410,'Abel Bretones','10','C.A. OSASUNA',NULL),
        (411,'Moncayola','11','C.A. OSASUNA',NULL),
        (412,'Torró','12','C.A. OSASUNA',NULL),
        (413,'Iker Muñoz','13','C.A. OSASUNA',NULL),
        (414,'Rubén García','14','C.A. OSASUNA',NULL),
        (415,'Moi Gómez','15','C.A. OSASUNA',NULL),
        (416,'Aimar Oroz','16','C.A. OSASUNA',NULL),
        (417,'Víctor Muñoz','17','C.A. OSASUNA',NULL),
        (418,'Kike Barja','18','C.A. OSASUNA',NULL),
        (419,'Budimir','19','C.A. OSASUNA',NULL),
        (420,'Raul García','20','C.A. OSASUNA',NULL),
        (431,'Escudo Real Oviedo','1','REAL OVIEDO',NULL),
        (432,'Entrenador Real Oviedo - Veljko Paunovic','2','REAL OVIEDO',NULL),
        (433,'Aarón Escandell','3','REAL OVIEDO',NULL),
        (434,'Moldovan','4','REAL OVIEDO',NULL),
        (435,'Nacho Vidal','5','REAL OVIEDO',NULL),
        (436,'Dani Calvo','6','REAL OVIEDO',NULL),
        (437,'Luengo','7','REAL OVIEDO',NULL),
        (438,'David Costas','8','REAL OVIEDO',NULL),
        (439,'Rahim Alhassane','9','REAL OVIEDO',NULL),
        (440,'Ejaria','10','REAL OVIEDO',NULL),
        (441,'Colombatto','11','REAL OVIEDO',NULL),
        (442,'Reina','12','REAL OVIEDO',NULL),
        (443,'Sibo','13','REAL OVIEDO',NULL),
        (444,'Santi Cazorla','14','REAL OVIEDO',NULL),
        (445,'Ilic','15','REAL OVIEDO',NULL),
        (446,'Álex Cardero','16A','REAL OVIEDO',NULL),
        (447,'Lucas Ahijado','16B','REAL OVIEDO',NULL),
        (448,'Hassan','17','REAL OVIEDO',NULL),
        (449,'Ilyas Chaira','18A','REAL OVIEDO',NULL),
        (450,'Fede Viñas','18B','REAL OVIEDO',NULL),
        (451,'Paraschiv','19','REAL OVIEDO',NULL),
        (452,'Paulino','20','REAL OVIEDO',NULL),
        (453,'Brekalo','19BIS','REAL OVIEDO',NULL),
        (454,'Álex Forés','20BIS','REAL OVIEDO',NULL),
        (461,'Escudo Rayo Vallecano','1','RAYO VALLECANO',NULL),
        (462,'Entrenador Rayo Vallecano - Íñigo Pérez','2','RAYO VALLECANO',NULL),
        (463,'Batalla','3','RAYO VALLECANO',NULL),
        (464,'Cárdenas','4','RAYO VALLECANO',NULL),
        (465,'Balliu','5','RAYO VALLECANO',NULL),
        (466,'Ratiu','6','RAYO VALLECANO',NULL),
        (467,'Lejeune','7','RAYO VALLECANO',NULL),
        (468,'Mumin','8','RAYO VALLECANO',NULL),
        (469,'Espino','9','RAYO VALLECANO',NULL),
        (470,'Pep Chavarria','10','RAYO VALLECANO',NULL),
        (471,'Pathé Ciss','11','RAYO VALLECANO',NULL),
        (472,'Óscar Valentín','12','RAYO VALLECANO',NULL),
        (473,'Pedro Díaz','13','RAYO VALLECANO',NULL),
        (474,'Isi','14','RAYO VALLECANO',NULL),
        (475,'Nteka','15A','RAYO VALLECANO',NULL),
        (476,'Trejo','15B','RAYO VALLECANO',NULL),
        (477,'Unai López','16','RAYO VALLECANO',NULL),
        (478,'Camello','17','RAYO VALLECANO',NULL),
        (479,'De Frutos','18','RAYO VALLECANO',NULL),
        (480,'Álvaro García','19','RAYO VALLECANO',NULL),
        (481,'Etienne Etoo','20','RAYO VALLECANO',NULL),
        (482,'Gumbau','13BIS','RAYO VALLECANO',NULL),
        (491,'Escudo Real Sociedad','1','REAL SOCIEDAD',NULL),
        (492,'Entrenador Real Sociedad - Sergio Francisco','2','REAL SOCIEDAD',NULL),
        (493,'Remiro','3','REAL SOCIEDAD',NULL),
        (494,'Marrero','4','REAL SOCIEDAD',NULL),
        (495,'Aramburu','5A','REAL SOCIEDAD',NULL),
        (496,'Traoré','5B','REAL SOCIEDAD',NULL),
        (497,'Martín','6','REAL SOCIEDAD',NULL),
        (498,'Zubeldia','7','REAL SOCIEDAD',NULL),
        (499,'Pacheco','8','REAL SOCIEDAD',NULL),
        (500,'Aritz Elustondo','9','REAL SOCIEDAD',NULL),
        (501,'Javi López','10A','REAL SOCIEDAD',NULL),
        (502,'Aihen Muñoz','10B','REAL SOCIEDAD',NULL),
        (503,'Turrientes','11','REAL SOCIEDAD',NULL),
        (504,'Pablo Marín','12','REAL SOCIEDAD',NULL),
        (505,'Sergio Gómez','13','REAL SOCIEDAD',NULL),
        (506,'Brais Méndez','14A','REAL SOCIEDAD',NULL),
        (507,'Olasagasti','14B','REAL SOCIEDAD',NULL),
        (508,'Sucic','15','REAL SOCIEDAD',NULL),
        (509,'Kubo','16','REAL SOCIEDAD',NULL),
        (510,'Barrenetxea','17','REAL SOCIEDAD',NULL),
        (511,'Oyarzabal','18','REAL SOCIEDAD',NULL),
        (512,'Mariezkurrena','19','REAL SOCIEDAD',NULL),
        (513,'Óskarsson','20','REAL SOCIEDAD',NULL),
        (514,'Zakharyan','15BIS','REAL SOCIEDAD',NULL),
        (521,'Escudo Sevilla FC','1','SEVILLA FC',NULL),
        (522,'Entrenador Sevilla FC - Matías Almeyda','2','SEVILLA FC',NULL),
        (523,'Nyland','3','SEVILLA FC',NULL),
        (524,'Álvaro Fernández','4','SEVILLA FC',NULL),
        (525,'Carmona','5','SEVILLA FC',NULL),
        (526,'Juanlu','6','SEVILLA FC',NULL),
        (527,'Kike Salas','7A','SEVILLA FC',NULL),
        (528,'Marcao','7B','SEVILLA FC',NULL),
        (529,'Badé','8','SEVILLA FC',NULL),
        (530,'Nianzou','9','SEVILLA FC',NULL),
        (531,'Pedrosa','10','SEVILLA FC',NULL),
        (532,'Gudelj','11','SEVILLA FC',NULL),
        (533,'Sow','12','SEVILLA FC',NULL),
        (534,'Agoumé','13','SEVILLA FC',NULL),
        (535,'Vargas','14','SEVILLA FC',NULL),
        (536,'Manu Bueno','15','SEVILLA FC',NULL),
        (537,'Peque','16','SEVILLA FC',NULL),
        (538,'Ejuke','17','SEVILLA FC',NULL),
        (539,'Lukebakio','18','SEVILLA FC',NULL),
        (540,'Isaac Romero','19','SEVILLA FC',NULL),
        (541,'Akor Adams','20A','SEVILLA FC',NULL),
        (542,'Idumbo','20B','SEVILLA FC',NULL),
        (543,'Vlachodimos','4BIS','SEVILLA FC',NULL),
        (551,'Escudo Valencia CF','1','VALENCIA CF',NULL),
        (552,'Entrenador Valencia CF - Carlos Corberán','2','VALENCIA CF',NULL),
        (553,'Dimitrievski','3','VALENCIA CF',NULL),
        (554,'Agirrezabala','4','VALENCIA CF',NULL),
        (555,'Correia','5A','VALENCIA CF',NULL),
        (556,'Foulquier','5B','VALENCIA CF',NULL),
        (557,'Mosquera','6','VALENCIA CF',NULL),
        (558,'Diakhaby','7','VALENCIA CF',NULL),
        (559,'Tárrega','8','VALENCIA CF',NULL),
        (560,'Yarek','9A','VALENCIA CF',NULL),
        (561,'Jesús Vázquez','9B','VALENCIA CF',NULL),
        (562,'Gayà','10','VALENCIA CF',NULL),
        (563,'Santamaria','11','VALENCIA CF',NULL),
        (564,'Guillamón','12','VALENCIA CF',NULL),
        (565,'Pepelu','13','VALENCIA CF',NULL),
        (566,'André Almeida','14','VALENCIA CF',NULL),
        (567,'Javi Guerra','15','VALENCIA CF',NULL),
        (568,'Luis Rioja','16','VALENCIA CF',NULL),
        (569,'Canós','17','VALENCIA CF',NULL),
        (570,'Fran Pérez','18','VALENCIA CF',NULL),
        (571,'Hugo Duro','19','VALENCIA CF',NULL),
        (572,'Diego López','20','VALENCIA CF',NULL),
        (573,'Copete','6BIS','VALENCIA CF',NULL),
        (574,'Danjuma','18BIS','VALENCIA CF',NULL),
        (581,'Escudo Villarreal CF','1','VILLARREAL CF',NULL),
        (582,'Entrenador Villarreal CF - Marcelino García','2','VILLARREAL CF',NULL),
        (583,'Luiz Júnior','3','VILLARREAL CF',NULL),
        (584,'Diego Conde','4','VILLARREAL CF',NULL),
        (585,'Pau Navarro','5','VILLARREAL CF',NULL),
        (586,'Foyth','6','VILLARREAL CF',NULL),
        (587,'Logan Costa','7','VILLARREAL CF',NULL),
        (588,'Kambwala','8','VILLARREAL CF',NULL),
        (589,'Sergi Cardona','9','VILLARREAL CF',NULL),
        (590,'Pedraza','10','VILLARREAL CF',NULL),
        (591,'Santi Comesaña','11','VILLARREAL CF',NULL),
        (592,'Pape Gueye','12','VILLARreal CF',NULL),
        (593,'Parejo','13','VILLARREAL CF',NULL),
        (594,'Denis Suárez','14','VILLARREAL CF',NULL),
        (595,'Yeremy Pino','15','VILLARREAL CF',NULL),
        (596,'Ilias','16','VILLARREAL CF',NULL),
        (597,'Pépé','17','VILLARREAL CF',NULL),
        (598,'Gerard Moreno','18','VILLARREAL CF',NULL),
        (599,'Ayoze','19','VILLARREAL CF',NULL),
        (600,'Barry','20','VILLARREAL CF',NULL),
        (601,'Buchanan','20BIS','VILLARREAL CF',NULL),
        (602,'Thomas','14BIS','VILLARREAL CF',NULL),
        (611,'Asencio','1','REAL MADRID','ADN LaLiga / Super Kids'),
        (612,'Balde','2','FC BARCELONA','ADN LaLiga / Super Kids'),
        (613,'Barrios','3','ATLÉTICO DE MADRID','ADN LaLiga / Super Kids'),
        (614,'Barry','4','VILLARREAL CF','ADN LaLiga / Super Kids'),
        (615,'Casadó','5','FC BARCELONA','ADN LaLiga / Super Kids'),
        (616,'Cubarsí','6','FC BARCELONA','ADN LaLiga / Super Kids'),
        (617,'Diego López','7','VALENCIA CF','ADN LaLiga / Super Kids'),
        (618,'Fer López','8','RC CELTA','ADN LaLiga / Super Kids'),
        (619,'Giuliano','9','ATLÉTICO DE MADRID','ADN LaLiga / Super Kids'),
        (620,'Güler','10','REAL MADRID','ADN LaLiga / Super Kids'),
        (621,'Jauregizar','11','ATHLETIC CLUB','ADN LaLiga / Super Kids'),
        (622,'Javi Guerra','12','VALENCIA CF','ADN LaLiga / Super Kids'),
        (623,'Jesús Rodríguez','13','REAL BETIS','ADN LaLiga / Super Kids'),
        (624,'Lamine Yamal','14','FC BARCELONA','ADN LaLiga / Super Kids'),
        (625,'Pablo Marín','15','REAL SOCIEDAD','ADN LaLiga / Super Kids'),
        (631,'Batalla','1','RAYO VALLECANO','Mister Cero'),
        (632,'Courtois','2','REAL MADRID','Mister Cero'),
        (633,'David Soria','3','GETAFE CF','Mister Cero'),
        (634,'Dimitrievski','4','VALENCIA CF','Mister Cero'),
        (635,'Gazzaniga','5','GIRONA FC','Mister Cero'),
        (636,'Luiz Júnior','6','VILLARREAL CF','Mister Cero'),
        (637,'Lunin','7','REAL MADRID','Mister Cero'),
        (638,'Nyland','8','SEVILLA FC','Mister Cero'),
        (639,'Oblak','9','ATLÉTICO DE MADRID','Mister Cero'),
        (640,'Remiro','10','REAL SOCIEDAD','Mister Cero'),
        (641,'Sergio Herrera','11','C.A. OSASUNA','Mister Cero'),
        (642,'Sivera','12','DEPORTIVO ALAVÉS','Mister Cero'),
        (643,'Unai Simón','13','ATHLETIC CLUB','Mister Cero'),
        (644,'Casillas','14','REAL MADRID','Icono Mister Cero'),
        (645,'Reina','15','VILLARREAL CF','Icono Mister Cero'),
        (646,'Víctor Valdés','16','FC BARCELONA','Icono Mister Cero'),
        (651,'Aimar Oroz / Budimir','1','C.A. OSASUNA','Mix'),
        (652,'Arambarri / Milla','2','GETAFE CF','Mix'),
        (653,'Asencio / Rüdiger','3','REAL MADRID','Mix'),
        (654,'Cubarsí / Íñigo Martínez','4','FC BARCELONA','Mix'),
        (655,'Darder / Muriqi','5','RCD MALLORCA','Mix'),
        (656,'De Paul / Barrios','6','ATLÉTICO DE MADRID','Mix'),
        (657,'Fede Valverde / Bellingham','7','REAL MADRID','Mix'),
        (658,'Fer López / Iago Aspas','8','RC CELTA','Mix'),
        (659,'Giuliano / Sorloth','9','ATLÉTICO DE MADRID','Mix'),
        (660,'Griezmann / Julián Álvarez','10','ATLÉTICO DE MADRID','Mix'),
        (661,'Isco / Lo Celso','11','REAL BETIS','Mix'),
        (662,'Isi / Álvaro García','12','RAYO VALLECANO','Mix'),
        (663,'Jauregizar / Sancet','13','ATHLETIC CLUB','Mix'),
        (664,'Javi Guerra / Hugo Duro','14','VALENCIA CF','Mix'),
        (665,'Jesús Rodríguez / Cucho Hernández','15','REAL BETIS','Mix'),
        (666,'Jofre / Puado','16','RCD ESPANYOL','Mix'),
        (667,'Kubo / Oyarzabal','17','REAL SOCIEDAD','Mix'),
        (668,'Mingueza / Javi Rodríguez','18','RC CELTA','Mix'),
        (669,'Parejo / Ayoze','19','VILLARREAL CF','Mix'),
        (670,'Pedri / Lamine Yamal','20','FC BARCELONA','Mix'),
        (671,'Raphinha / Lewandowski','21','FC BARCELONA','Mix'),
        (672,'Vinícius / Mbappé','22','REAL MADRID','Mix'),
        (673,'Williams / Nico Williams','23','ATHLETIC CLUB','Mix'),
        (681,'Huijsen','1',NULL,'Últimos Fichajes'),
        (682,'Jutglà','2',NULL,'Últimos Fichajes'),
        (683,'Pablo Ibáñez','3',NULL,'Últimos Fichajes'),
        (684,'Robert Navarro','4',NULL,'Últimos Fichajes'),
        (685,'Rafa Marín','5',NULL,'Últimos Fichajes'),
        (686,'Toljan','6',NULL,'Últimos Fichajes'),
        (687,'Miguel Rubio','7',NULL,'Últimos Fichajes'),
        (688,'Joan García','8',NULL,'Últimos Fichajes'),
        (689,'Trent','9',NULL,'Últimos Fichajes'),
        (690,'Riquelme','10',NULL,'Últimos Fichajes'),
        (691,'Raba','11',NULL,'Últimos Fichajes'),
        (692,'Pablo Torre','12',NULL,'Últimos Fichajes'),
        (693,'Hugo Rincón','13',NULL,'Últimos Fichajes'),
        (694,'Kike García','14',NULL,'Últimos Fichajes'),
        (695,'Moleiro','15',NULL,'Últimos Fichajes'),
        (696,'Alfon','16',NULL,'Últimos Fichajes'),
        (697,'Valentín Gómez','17',NULL,'Últimos Fichajes'),
        (698,'Carreras','18',NULL,'Últimos Fichajes'),
        (699,'Gorrotxategi','19',NULL,'Últimos Fichajes'),
        (700,'Rashford','20',NULL,'Últimos Fichajes'),
        (701,'Valles','21',NULL,'Últimos Fichajes'),
        (702,'Brandon Domingues','22',NULL,'Últimos Fichajes'),
        (703,'Kiko Femenía','23',NULL,'Últimos Fichajes'),
        (704,'Álex Baena','24',NULL,'Últimos Fichajes'),
        (705,'Chust','25',NULL,'Últimos Fichajes'),
        (706,'Suazo','26',NULL,'Últimos Fichajes'),
        (707,'Dolan','27',NULL,'Últimos Fichajes'),
        (708,'Vitor Reis','28',NULL,'Últimos Fichajes'),
        (709,'Caleta-Car','29',NULL,'Últimos Fichajes'),
        (710,'Mouriño','30',NULL,'Últimos Fichajes'),
        (711,'Bryan Zaragoza','31',NULL,'Últimos Fichajes'),
        (712,'Areso','32',NULL,'Últimos Fichajes'),
        (713,'Mateo Joseph','33',NULL,'Últimos Fichajes'),
        (714,'Liso','34',NULL,'Últimos Fichajes'),
        (715,'Hancko','35',NULL,'Últimos Fichajes'),
        (716,'Guedes','36',NULL,'Últimos Fichajes'),
        (717,'Ugrinic','37',NULL,'Últimos Fichajes'),
        (718,'Rondón','38',NULL,'Últimos Fichajes'),
        (719,'Deossa','39',NULL,'Últimos Fichajes'),
        (720,'Lemar','40',NULL,'Últimos Fichajes'),
        (721,'Bardghji','41',NULL,'Últimos Fichajes'),
        (722,'Raspadori','42',NULL,'Últimos Fichajes'),
        (723,'Koyalipou','43',NULL,'Últimos Fichajes'),
        (724,'André Silva','44',NULL,'Últimos Fichajes'),
        (725,'Renato Veiga','45',NULL,'Últimos Fichajes'),
        (726,'Mastantuono','46',NULL,'Últimos Fichajes'),
        (761,'Ayoze','1','VILLARREAL CF','Extra Gold'),
        (762,'Bellingham','2','REAL MADRID','Extra Gold'),
        (763,'Budimir','3','C.A. OSASUNA','Extra Gold'),
        (764,'Isco','4','REAL BETIS','Extra Gold'),
        (765,'Lewandowski','5','FC BARCELONA','Extra Gold'),
        (766,'Nico Williams','6','ATHLETIC CLUB','Extra Gold'),
        (767,'Pedri','7','FC BARCELONA','Extra Gold'),
        (768,'Sancet','8','ATHLETIC CLUB','Extra Gold'),
        (769,'Raphinha','9','FC BARCELONA','Extra Gold'),
        (770,'Vinícius','10','REAL MADRID','Extra Gold'),
        (771,'Julián Álvarez','11','ATLÉTICO DE MADRID','Supreme Extra Gold'),
        (772,'Lamine Yamal','12','FC BARCELONA','Supreme Extra Gold'),
        (773,'Mbappé','13','REAL MADRID','Supreme Extra Gold')
), 
inserted_stickers AS (
    INSERT INTO stickers (collection_id, team_id, player_name, code, sticker_number, rarity, position)
    SELECT
        new_collection_id,
        (team_map->>team_name)::BIGINT,
        name,
        CASE
            WHEN special_page_name IS NOT NULL THEN
                concat(
                    'SPECIAL-',
                    upper(regexp_replace(special_page_name, '[^A-Za-z0-9]', '', 'g')),
                    CASE
                        WHEN team_name IS NOT NULL THEN '-' || upper(regexp_replace(team_name, '[^A-Za-z0-9]', '', 'g'))
                        ELSE ''
                    END,
                    '-',
                    code
                )
            ELSE
                concat(upper(regexp_replace(team_name, '[^A-Za-z0-9]', '', 'g')), '-', code)
        END,
        raw_id,
        'common', -- Default rarity
        CASE
            WHEN name LIKE 'Escudo%' THEN 'Badge'
            WHEN name LIKE 'Entrenador%' THEN 'Coach'
            ELSE 'Player'
        END
    FROM stickers_data
    RETURNING id, team_id, sticker_number
),
slot_assignments AS (
    SELECT
        slot_data.target_page_id,
        slot_data.sticker_id,
        ROW_NUMBER() OVER (
            PARTITION BY slot_data.page_key
            ORDER BY slot_data.base_slot, slot_data.variant_rank, slot_data.raw_id
        ) - 1 AS slot_index
    FROM (
        SELECT
            COALESCE(d.special_page_name, t.title) AS page_key,
            (page_map->>COALESCE(d.special_page_name, t.title))::BIGINT AS target_page_id,
            i.id AS sticker_id,
            d.raw_id,
            CASE
                WHEN d.code ~ '^[0-9]+$' THEN (d.code::INT - 1)
                WHEN d.code ~ '^[0-9]+[A-Z]+$' THEN (regexp_replace(d.code, '[^0-9]', '', 'g'))::INT - 1
                ELSE 999
            END AS base_slot,
            CASE
                WHEN d.code ~ '^[0-9]+$' THEN 0
                WHEN d.code ~ '^[0-9]+A$' THEN 1
                WHEN d.code ~ '^[0-9]+B$' THEN 2
                WHEN d.code ~ '^[0-9]+C$' THEN 3
                WHEN d.code ~ '^[0-9]+BIS$' THEN 4
                ELSE 9
            END AS variant_rank
        FROM stickers_data d
        JOIN inserted_stickers i ON i.sticker_number = d.raw_id AND i.team_id IS NOT DISTINCT FROM (team_map->>d.team_name)::BIGINT
        LEFT JOIN collection_pages t ON t.collection_id = new_collection_id AND t.team_id IS NOT DISTINCT FROM (team_map->>d.team_name)::BIGINT
    ) slot_data
)
INSERT INTO page_slots (page_id, sticker_id, slot_index)
SELECT
    target_page_id,
    sticker_id,
    slot_index
FROM slot_assignments;

END;
$$;