## ðŸ“¦ Subtask 3.4: Create RPC `get_my_listings_with_progress`

### Prompt for Claude CLI:
```
I need an RPC to view "My Listings" with inventory synchronization.

CONTEXT:
- "My Listings" view in profile
- Show listings with updated slot count
- Detect inconsistencies (active listing but count = 0)

TASK:
Create a SQL migration with the function:

FUNCTION: get_my_listings_with_progress
SECURITY: SECURITY DEFINER
PARAMETERS:
- p_status TEXT DEFAULT NULL (if NULL, get all; if 'active', only active)
- p_limit INTEGER DEFAULT 50
- p_offset INTEGER DEFAULT 0

RETURNS: TABLE
- listing_id BIGINT
- title TEXT
- description TEXT
- sticker_number TEXT
- collection_name TEXT
- image_url TEXT
- status TEXT
- views_count INTEGER
- created_at TIMESTAMPTZ
- copy_id BIGINT (can be NULL)
- slot_id BIGINT (can be NULL)
- current_count INTEGER (if from template, current count; if NULL, doesn't apply)
- needs_attention BOOLEAN (TRUE if status = 'active' and current_count = 0)

LOGIC:
1. SELECT from trade_listings WHERE user_id = auth.uid()

2. LEFT JOIN with user_template_progress:
   LEFT JOIN user_template_progress utp 
   ON utp.user_id = auth.uid() 
   AND utp.copy_id = trade_listings.copy_id 
   AND utp.slot_id = trade_listings.slot_id

3. Calculate current_count:
   - If copy_id IS NOT NULL: utp.count
   - If copy_id IS NULL: NULL

4. Calculate needs_attention:
   - TRUE if status = 'active' AND copy_id IS NOT NULL AND current_count = 0
   - FALSE otherwise

5. Filter by p_status if not NULL

6. ORDER BY created_at DESC

7. LIMIT and OFFSET

USAGE:
- Frontend can show red alert if needs_attention = TRUE
- "You no longer have this card, consider removing the listing"

PERMISSIONS:
- GRANT EXECUTE TO authenticated

DELIVERABLES:
1. File: supabase/migrations/YYYYMMDDHHMMSS_get_my_listings_with_progress_rpc.sql
2. Include usage example
3. Explain needs_attention flag

Give me git commands afterwards.
```
